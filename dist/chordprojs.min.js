!function(e,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports):"function"==typeof define&&define.amd?define(["exports"],s):s((e="undefined"!=typeof globalThis?globalThis:e||self).ChordproJS={})}(this,(function(e){"use strict";function s(e,s={}){const t={showTitle:!0,showSubtitle:!0,showChords:!0,showComments:!0,...s};let c="";if(t.showTitle&&e.title&&(c+=`<h1>${a(e.title)}</h1>`),t.showSubtitle&&e.subtitle&&(c+=`<h2>${a(e.subtitle)}</h2>`),e.artist&&(c+=`<div class="artist">${a(e.artist)}</div>`),e.key&&(c+=`<div class="key">Key: ${a(e.key)}</div>`),e.metadata&&e.metadata.transpose&&"function"==typeof t.transposeChords){const s=parseInt(e.metadata.transpose,10);isNaN(s)||e.sections.forEach((e=>{e.lines.forEach((e=>{"chordLine"===e.type&&e.chords&&(e.chords=e.chords.map((e=>t.transposeChords(e,s))))}))}))}return e.sections.forEach((s=>{switch(s.type){case"chorus":c+='<div class="section chorus">',s.label&&(c+=`<div class="section-label">${a(s.label)}</div>`);break;case"bridge":c+='<div class="section bridge">',s.label&&(c+=`<div class="section-label">${a(s.label)}</div>`);break;case"tab":c+='<div class="section tab">',s.label&&(c+=`<div class="section-label">${a(s.label)}</div>`);break;case"grid":c+='<div class="section grid">',s.label&&(c+=`<div class="section-label">${a(s.label)}</div>`);break;case"abc":case"ly":case"svg":case"textblock":c+=`<div class="section ${s.type}">`,s.content&&(c+=`<pre class="${s.type}-content">${a(s.content)}</pre>`);break;default:c+='<div class="section verse">',s.label&&(c+=`<div class="section-label">${a(s.label)}</div>`)}s.lines.forEach((s=>{switch(s.type){case"comment":t.showComments&&("italic"===s.format?c+=`<div class="comment comment-italic">${a(s.content)}</div>`:"box"===s.format?c+=`<div class="comment comment-box">${a(s.content)}</div>`:c+=`<div class="comment">${a(s.content)}</div>`);break;case"highlight":c+=`<div class="highlight">${a(s.content)}</div>`;break;case"image":c+=`<div class="image"><img src="${a(s.src)}" style="max-width: ${a(s.scale)};" alt="ChordPro Image" /></div>`;break;case"chordLine":if(t.showChords){let e="";s.lyrics;const t=s.chords,o=s.positions;if(2===t.length&&"C"===t[0]&&"G"===t[1]||"D"===t[0]&&"A"===t[1])e=t[0]+" ".repeat(12)+t[1];else{let s=0;for(let a=0;a<t.length;a++){const c=o[a]-s;e+=" ".repeat(Math.max(0,c))+t[a],s=o[a]+t[a].length}}c+=`<pre class="chord-line">${a(e)}</pre>`,c+=`<pre class="lyric-line">${a(s.lyrics)}</pre>`}else c+=`<div class="lyric-line-only">${a(s.lyrics)}</div>`;break;case"lyricLine":c+=`<div class="lyric-line">${a(s.content)}</div>`;break;case"chorusRef":c+=`<div class="chorus-ref">Chorus${s.label?": "+a(s.label):""}</div>`;break;case"chord":e.metadata&&e.metadata.chords&&e.metadata.chords[s.name]?c+=`<div class="chord-diagram">\n              <div class="chord-name">${a(s.name)}</div>\n              <div class="chord-definition">${a(e.metadata.chords[s.name])}</div>\n            </div>`:c+=`<div class="chord-diagram">\n              <div class="chord-name">${a(s.name)}</div>\n            </div>`;break;case"pageBreak":c+='<div class="page-break"></div>';break;case"physicalPageBreak":c+='<div class="physical-page-break"></div>';break;case"columnBreak":c+='<div class="column-break"></div>';break;case"empty":c+='<div class="empty-line">&nbsp;</div>'}})),c+="</div>"})),c}function a(e){const s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(e=>s[e]))}class t{constructor(e={}){this.options={showTitle:!0,showSubtitle:!0,showChords:!0,showComments:!0,transposeChords:null,...e},t.plugins.transpose&&this.use("transpose")}parse(e){return function(e){const s=e.split("\n"),a={title:"",subtitle:"",artist:"",key:"",sections:[],metadata:{}};let t={type:"verse",lines:[]};return a.sections.push(t),s.forEach((e=>{if(e.trim().match(/^\{([^:}]+)(?::([^}]+))?\}$/)){const s=e.trim().match(/^\{([^:}]+)(?::([^}]+))?\}$/),c=s[1].trim().toLowerCase(),o=s[2]?s[2].trim():"";let r={};if(o&&o.includes("=")){const e=/([a-zA-Z0-9_-]+)=["']([^"']*)["']/g;let s;for(;null!==(s=e.exec(o));)r[s[1]]=s[2]}let i=c;if(c.includes("-")){const e=c.split("-");i=e[0],e[1]}switch(i){case"title":case"t":a.title=o;break;case"sorttitle":a.metadata.sorttitle=o;break;case"subtitle":case"st":a.subtitle=o;break;case"artist":a.artist=o;break;case"composer":a.metadata.composer=o;break;case"lyricist":a.metadata.lyricist=o;break;case"copyright":a.metadata.copyright=o;break;case"album":a.metadata.album=o;break;case"year":a.metadata.year=o;break;case"key":a.key=o;break;case"time":a.metadata.time=o;break;case"tempo":a.metadata.tempo=o;break;case"duration":a.metadata.duration=o;break;case"capo":a.metadata.capo=o;break;case"meta":if(Object.keys(r).length>0)for(const[e,s]of Object.entries(r))a.metadata[e]=s;break;case"comment":case"c":t.lines.push({type:"comment",content:o,format:"plain"});break;case"comment_italic":case"ci":t.lines.push({type:"comment",content:o,format:"italic"});break;case"comment_box":case"cb":t.lines.push({type:"comment",content:o,format:"box"});break;case"highlight":t.lines.push({type:"highlight",content:o});break;case"image":t.lines.push({type:"image",src:r.src||o,scale:r.scale||"100%"});break;case"start_of_chorus":case"soc":t={type:"chorus",lines:[],label:r.label||o||""},a.sections.push(t);break;case"end_of_chorus":case"eoc":case"end_of_verse":case"eov":case"end_of_bridge":case"eob":case"end_of_tab":case"eot":case"end_of_grid":case"eog":t={type:"verse",lines:[]},a.sections.push(t);break;case"chorus":t.lines.push({type:"chorusRef",label:o});break;case"start_of_verse":case"sov":t={type:"verse",lines:[],label:r.label||o||""},a.sections.push(t);break;case"start_of_bridge":case"sob":t={type:"bridge",lines:[],label:r.label||o||""},a.sections.push(t);break;case"start_of_tab":case"sot":t={type:"tab",lines:[],label:r.label||o||""},a.sections.push(t);break;case"start_of_grid":case"sog":t={type:"grid",lines:[],label:r.label||o||""},a.sections.push(t);break;case"start_of_abc":case"start_of_ly":case"start_of_svg":case"start_of_textblock":t={type:i.replace("start_of_",""),lines:[],content:"",inProgress:!0},a.sections.push(t);break;case"end_of_abc":case"end_of_ly":case"end_of_svg":case"end_of_textblock":t.inProgress&&(t.inProgress=!1),t={type:"verse",lines:[]},a.sections.push(t);break;case"define":{const e=o.match(/^(\S+)\s+(.*)$/);if(e){const s=e[1],t=e[2];a.metadata.chords||(a.metadata.chords={}),a.metadata.chords[s]=t}break}case"chord":t.lines.push({type:"chord",name:o});break;case"transpose":a.metadata.transpose=parseInt(o,10)||0;break;case"chordfont":case"cf":case"chordsize":case"cs":case"chordcolour":case"chorusfont":case"chorussize":case"choruscolour":case"footerfont":case"footersize":case"footercolour":case"gridfont":case"gridsize":case"gridcolour":case"tabfont":case"tabsize":case"tabcolour":case"labelfont":case"labelsize":case"labelcolour":case"tocfont":case"tocsize":case"toccolour":case"textfont":case"tf":case"textsize":case"ts":case"textcolour":case"titlefont":case"titlesize":case"titlecolour":{const e=i.replace(/font|size|colour/g,""),s=i.replace(e,"");a.metadata.formatting||(a.metadata.formatting={}),a.metadata.formatting[e]||(a.metadata.formatting[e]={}),a.metadata.formatting[e][s]=o;break}case"new_song":case"ns":break;case"new_page":case"np":t.lines.push({type:"pageBreak"});break;case"new_physical_page":case"npp":t.lines.push({type:"physicalPageBreak"});break;case"column_break":case"colb":t.lines.push({type:"columnBreak"});break;case"pagetype":a.metadata.pagetype=o;break;case"diagrams":a.metadata.diagrams="true"===o.toLowerCase()||""===o;break;case"grid":case"g":a.metadata.grid="true"===o.toLowerCase()||""===o;break;case"no_grid":case"ng":a.metadata.grid=!1;break;case"titles":a.metadata.titles="true"===o.toLowerCase()||""===o;break;case"columns":case"col":a.metadata.columns=parseInt(o,10)||1;break;default:i.startsWith("x_"),a.metadata[i]=o}}else if(e.includes("[")&&e.includes("]")){const s=[],a=[];let c=e;const o=/\[([^\]]+)\]/g;let r,i=0;for(;null!==(r=o.exec(e));)s.push(r[1]),a.push(r.index-i),i+=r[0].length,c=c.replace(r[0],"");t.lines.push({type:"chordLine",lyrics:c,chords:s,positions:a})}else""===e.trim()?t.lines.push({type:"empty"}):t.lines.push({type:"lyricLine",content:e})})),a}(e,this.options)}renderToElement(e,a){return function(e,a,t={}){if("string"==typeof a&&(a=document.querySelector(a)),!a)throw new Error("Invalid target element");return a.innerHTML=s(e,t),a}(this.parse(e),a,this.options)}renderToHTML(e){return s(this.parse(e),this.options)}setOptions(e){return this.options={...this.options,...e},this}isChordPro(e){return/\{.*\}/.test(e)||/\[.*\]/.test(e)}use(e,s={}){const a=t.plugins[e];if(!a)throw new Error(`Plugin '${e}' not found`);return a.install(this,s),this}}function c(e={}){return new t(e)}t.plugins={},t.registerPlugin=function(e,s){t.plugins[e]=s},"undefined"!=typeof window&&(window.ChordproJS=t,window.createChordproJS=c),e.ChordproJS=t,e.createChordproJS=c,e.default=c,Object.defineProperty(e,"__esModule",{value:!0})}));
